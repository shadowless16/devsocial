c45ccd89ff29b0bf3e67354d16ed6e8b
"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
// models/User.ts
const mongoose_1 = require("mongoose");
const UserSchema = new mongoose_1.Schema({
    username: {
        type: String,
        required: true,
        unique: true,
        trim: true,
        minlength: 3,
        maxlength: 30,
        index: true,
    },
    email: {
        type: String,
        required: true,
        unique: true,
        lowercase: true,
        trim: true,
        index: true,
    },
    password: {
        type: String,
        required: true,
        // You might want to add select: false here to hide it from queries
        // select: false, 
    },
    firstName: {
        type: String,
        trim: true,
        maxlength: 50,
    },
    lastName: {
        type: String,
        trim: true,
        maxlength: 50,
    },
    birthMonth: {
        type: Number,
        min: 1,
        max: 12,
    },
    birthDay: {
        type: Number,
        min: 1,
        max: 31,
    },
    bio: {
        type: String,
        maxlength: 250,
        default: "",
    },
    affiliation: {
        type: String,
        maxlength: 100,
        default: "Other",
    },
    techCareerPath: {
        type: String,
        enum: ["Frontend Developer", "Backend Developer", "Full Stack Developer", "Mobile Developer", "DevOps Engineer", "Data Scientist", "ML Engineer", "Cloud Architect", "Security Engineer", "UI/UX Designer", "Other"],
    },
    techStack: [{
            type: String,
            trim: true,
        }],
    experienceLevel: {
        type: String,
        enum: ["beginner", "intermediate", "advanced", "expert"],
        default: "beginner",
    },
    githubUsername: {
        type: String,
        trim: true,
    },
    linkedinUrl: {
        type: String,
        trim: true,
    },
    portfolioUrl: {
        type: String,
        trim: true,
    },
    avatar: {
        type: String,
        default: "", // We set default to empty string so the pre-save hook can catch it
    },
    gender: {
        type: String,
        enum: ["male", "female", "other"],
    },
    userType: {
        type: String,
        enum: ["student", "developer", "designer", "entrepreneur", "other"],
    },
    bannerUrl: {
        type: String,
        default: "", // New field for user banner
    },
    role: {
        type: String,
        enum: ["user", "moderator", "admin", "analytics"],
        default: "user",
    },
    points: {
        type: Number,
        default: 10, // Your default is 10, which is great!
        index: true,
    },
    badges: [{ type: String }],
    level: { type: Number, default: 1 },
    displayName: { type: String, trim: true },
    location: { type: String, trim: true },
    website: { type: String, trim: true },
    isVerified: { type: Boolean, default: false },
    verificationToken: { type: String, default: null },
    verificationTokenExpires: { type: Date, default: null },
    resetPasswordToken: { type: String, default: null },
    resetPasswordExpires: { type: Date, default: null },
    refreshTokens: [{ type: String }],
    lastLogin: { type: Date },
    loginStreak: { type: Number, default: 0 },
    lastStreakDate: { type: Date },
    referralCode: {
        type: String,
        unique: true,
        sparse: true,
        index: true,
    },
    onboardingCompleted: {
        type: Boolean,
        default: false,
        index: true,
    },
    followersCount: {
        type: Number,
        default: 0,
        index: true,
    },
    followingCount: {
        type: Number,
        default: 0,
        index: true,
    },
    lastActive: {
        type: Date,
        default: Date.now,
        index: true,
    },
    sessionStart: {
        type: Date,
        default: Date.now,
    },
    registrationSource: {
        type: String,
        enum: ['organic', 'referral', 'social', 'direct', 'email', 'search'],
        default: 'direct'
    },
    referrer: {
        type: String,
        default: ''
    },
    country: {
        type: String,
        trim: true,
    },
    isGenerated: {
        type: Boolean,
        default: false,
        index: true,
    },
    hederaAccountId: {
        type: String,
        trim: true,
        sparse: true,
        index: true,
    },
    walletConnected: {
        type: Boolean,
        default: false,
    },
    demoWalletBalance: {
        type: Number,
        default: 100, // Each user starts with 100 demo HBAR
        min: 0,
        index: true,
    },
}, { timestamps: true });
// --- START: COMBINED MIDDLEWARE ---
UserSchema.pre("save", function (next) {
    // 1. Level calculation logic
    if (this.isModified("points")) {
        this.level = Math.floor(this.points / 1000) + 1;
    }
    // 2. Generate avatar for new users (will be overridden during onboarding)
    if (this.isNew && !this.avatar) {
        const seed = this.username;
        if (this.gender === "male") {
            this.avatar = `https://models.readyplayer.me/64bfa75f0e72c63d7c3934a6.glb?morphTargets=ARKit&textureAtlas=1024&lod=1&gender=male&seed=${seed}`;
        }
        else if (this.gender === "female") {
            this.avatar = `https://models.readyplayer.me/64bfa75f0e72c63d7c3934a6.glb?morphTargets=ARKit&textureAtlas=1024&lod=1&gender=female&seed=${seed}`;
        }
        else {
            this.avatar = `https://models.readyplayer.me/64bfa75f0e72c63d7c3934a6.glb?morphTargets=ARKit&textureAtlas=1024&lod=1&seed=${seed}`;
        }
    }
    // 3. Generate referral code for new users
    if (this.isNew && !this.referralCode) {
        const timestamp = Date.now().toString(36);
        const username = this.username.substring(0, 4).toUpperCase();
        const random = Math.random().toString(36).substring(2, 6).toUpperCase();
        this.referralCode = `${username}${timestamp}${random}`;
    }
    next();
});
// --- END: COMBINED MIDDLEWARE ---
// Your existing methods
UserSchema.methods.calculateLevel = function () {
    return Math.floor(this.points / 1000) + 1;
};
UserSchema.methods.cleanExpiredTokens = function () {
    // ... (your existing logic is perfect)
};
exports.default = mongoose_1.models.User || (0, mongoose_1.model)("User", UserSchema);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxha2RhdlxcRG93bmxvYWRzXFxkZXZzb2NpYWxcXG1vZGVsc1xcVXNlci50cyIsIm1hcHBpbmdzIjoiOztBQUFBLGlCQUFpQjtBQUNqQix1Q0FBcUU7QUF3RHJFLE1BQU0sVUFBVSxHQUFHLElBQUksaUJBQU0sQ0FDM0I7SUFDRSxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsTUFBTTtRQUNaLFFBQVEsRUFBRSxJQUFJO1FBQ2QsTUFBTSxFQUFFLElBQUk7UUFDWixJQUFJLEVBQUUsSUFBSTtRQUNWLFNBQVMsRUFBRSxDQUFDO1FBQ1osU0FBUyxFQUFFLEVBQUU7UUFDYixLQUFLLEVBQUUsSUFBSTtLQUNaO0lBQ0QsS0FBSyxFQUFFO1FBQ0wsSUFBSSxFQUFFLE1BQU07UUFDWixRQUFRLEVBQUUsSUFBSTtRQUNkLE1BQU0sRUFBRSxJQUFJO1FBQ1osU0FBUyxFQUFFLElBQUk7UUFDZixJQUFJLEVBQUUsSUFBSTtRQUNWLEtBQUssRUFBRSxJQUFJO0tBQ1o7SUFDRCxRQUFRLEVBQUU7UUFDUixJQUFJLEVBQUUsTUFBTTtRQUNaLFFBQVEsRUFBRSxJQUFJO1FBQ2QsbUVBQW1FO1FBQ25FLGtCQUFrQjtLQUNuQjtJQUNELFNBQVMsRUFBRTtRQUNULElBQUksRUFBRSxNQUFNO1FBQ1osSUFBSSxFQUFFLElBQUk7UUFDVixTQUFTLEVBQUUsRUFBRTtLQUNkO0lBQ0QsUUFBUSxFQUFFO1FBQ1IsSUFBSSxFQUFFLE1BQU07UUFDWixJQUFJLEVBQUUsSUFBSTtRQUNWLFNBQVMsRUFBRSxFQUFFO0tBQ2Q7SUFDRCxVQUFVLEVBQUU7UUFDVixJQUFJLEVBQUUsTUFBTTtRQUNaLEdBQUcsRUFBRSxDQUFDO1FBQ04sR0FBRyxFQUFFLEVBQUU7S0FDUjtJQUNELFFBQVEsRUFBRTtRQUNSLElBQUksRUFBRSxNQUFNO1FBQ1osR0FBRyxFQUFFLENBQUM7UUFDTixHQUFHLEVBQUUsRUFBRTtLQUNSO0lBQ0QsR0FBRyxFQUFFO1FBQ0gsSUFBSSxFQUFFLE1BQU07UUFDWixTQUFTLEVBQUUs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dEMsdUNBQXVDO0FBQ3pDLENBQUMsQ0FBQztBQUVGLGtCQUFlLGlCQUFNLENBQUMsSUFBSSxJQUFJLElBQUEsZ0JBQUssRUFBUSxNQUFNLEVBQUUsVUFBVSxDQUFDLENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiQzpcXFVzZXJzXFxha2RhdlxcRG93bmxvYWRzXFxkZXZzb2NpYWxcXG1vZGVsc1xcVXNlci50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBtb2RlbHMvVXNlci50c1xuaW1wb3J0IG1vbmdvb3NlLCB7IFNjaGVtYSwgRG9jdW1lbnQsIG1vZGVscywgbW9kZWwgfSBmcm9tIFwibW9uZ29vc2VcIjtcblxuLy8gWW91ciBleGlzdGluZywgZGV0YWlsZWQgaW50ZXJmYWNlXG5leHBvcnQgaW50ZXJmYWNlIElVc2VyIGV4dGVuZHMgRG9jdW1lbnQge1xuICB1c2VybmFtZTogc3RyaW5nO1xuICBlbWFpbDogc3RyaW5nO1xuICBwYXNzd29yZDogc3RyaW5nO1xuICBmaXJzdE5hbWU/OiBzdHJpbmc7XG4gIGxhc3ROYW1lPzogc3RyaW5nO1xuICBiaXJ0aE1vbnRoPzogbnVtYmVyO1xuICBiaXJ0aERheT86IG51bWJlcjtcbiAgYmlvOiBzdHJpbmc7XG4gIGFmZmlsaWF0aW9uOiBzdHJpbmc7XG4gIGF2YXRhcjogc3RyaW5nO1xuICBiYW5uZXJVcmw6IHN0cmluZztcbiAgcm9sZTogXCJ1c2VyXCIgfCBcIm1vZGVyYXRvclwiIHwgXCJhZG1pblwiIHwgXCJhbmFseXRpY3NcIjtcbiAgZ2VuZGVyPzogXCJtYWxlXCIgfCBcImZlbWFsZVwiIHwgXCJvdGhlclwiO1xuICB1c2VyVHlwZT86IFwic3R1ZGVudFwiIHwgXCJkZXZlbG9wZXJcIiB8IFwiZGVzaWduZXJcIiB8IFwiZW50cmVwcmVuZXVyXCIgfCBcIm90aGVyXCI7XG4gIHRlY2hDYXJlZXJQYXRoPzogc3RyaW5nO1xuICB0ZWNoU3RhY2s/OiBzdHJpbmdbXTtcbiAgZXhwZXJpZW5jZUxldmVsPzogXCJiZWdpbm5lclwiIHwgXCJpbnRlcm1lZGlhdGVcIiB8IFwiYWR2YW5jZWRcIiB8IFwiZXhwZXJ0XCI7XG4gIGdpdGh1YlVzZXJuYW1lPzogc3RyaW5nO1xuICBsaW5rZWRpblVybD86IHN0cmluZztcbiAgcG9ydGZvbGlvVXJsPzogc3RyaW5nO1xuICBwb2ludHM6IG51bWJlcjtcbiAgYmFkZ2VzOiBzdHJpbmdbXTtcbiAgbGV2ZWw6IG51bWJlcjtcbiAgaXNWZXJpZmllZDogYm9vbGVhbjtcbiAgZGlzcGxheU5hbWU/OiBzdHJpbmc7XG4gIGxvY2F0aW9uPzogc3RyaW5nO1xuICB3ZWJzaXRlPzogc3RyaW5nO1xuICB2ZXJpZmljYXRpb25Ub2tlbj86IHN0cmluZztcbiAgdmVyaWZpY2F0aW9uVG9rZW5FeHBpcmVzPzogRGF0ZTtcbiAgcmVzZXRQYXNzd29yZFRva2VuPzogc3RyaW5nO1xuICByZXNldFBhc3N3b3JkRXhwaXJlcz86IERhdGU7XG4gIHJlZnJlc2hUb2tlbnM6IHN0cmluZ1tdO1xuICBsYXN0TG9naW4/OiBEYXRlO1xuICBsb2dpblN0cmVhazogbnVtYmVyO1xuICBsYXN0U3RyZWFrRGF0ZT86IERhdGU7XG4gIHJlZmVycmFsQ29kZT86IHN0cmluZztcbiAgb25ib2FyZGluZ0NvbXBsZXRlZDogYm9vbGVhbjtcbiAgZm9sbG93ZXJzQ291bnQ6IG51bWJlcjtcbiAgZm9sbG93aW5nQ291bnQ6IG51bWJlcjtcbiAgbGFzdEFjdGl2ZT86IERhdGU7XG4gIHNlc3Npb25TdGFydD86IERhdGU7XG4gIHJlZ2lzdHJhdGlvblNvdXJjZT86IHN0cmluZztcbiAgcmVmZXJyZXI/OiBzdHJpbmc7XG4gIGNvdW50cnk/OiBzdHJpbmc7XG4gIGlzR2VuZXJhdGVkPzogYm9vbGVhbjtcbiAgaGVkZXJhQWNjb3VudElkPzogc3RyaW5nO1xuICB3YWxsZXRDb25uZWN0ZWQ/OiBib29sZWFuO1xuICBkZW1vV2FsbGV0QmFsYW5jZTogbnVtYmVyO1xuICBjcmVhdGVkQXQ6IERhdGU7XG4gIHVwZGF0ZWRBdDogRGF0ZTtcbn1cblxuY29uc3QgVXNlclNjaGVtYSA9IG5ldyBTY2hlbWE8SVVzZXI+KFxuICB7XG4gICAgdXNlcm5hbWU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHJlcXVpcmVkOiB0cnVlLFxuICAgICAgdW5pcXVlOiB0cnVlLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICAgIG1pbmxlbmd0aDogMyxcbiAgICAgIG1heGxlbmd0aDogMzAsXG4gICAgICBpbmRleDogdHJ1ZSxcbiAgICB9LFxuICAgIGVtYWlsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIHVuaXF1ZTogdHJ1ZSxcbiAgICAgIGxvd2VyY2FzZTogdHJ1ZSxcbiAgICAgIHRyaW06IHRydWUsXG4gICAgICBpbmRleDogdHJ1ZSxcbiAgICB9LFxuICAgIHBhc3N3b3JkOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICByZXF1aXJlZDogdHJ1ZSxcbiAgICAgIC8vIFlvdSBtaWdodCB3YW50IHRvIGFkZCBzZWxlY3Q6IGZhbHNlIGhlcmUgdG8gaGlkZSBpdCBmcm9tIHF1ZXJpZXNcbiAgICAgIC8vIHNlbGVjdDogZmFsc2UsIFxuICAgIH0sXG4gICAgZmlyc3ROYW1lOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICB0cmltOiB0cnVlLFxuICAgICAgbWF4bGVuZ3RoOiA1MCxcbiAgICB9LFxuICAgIGxhc3ROYW1lOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICB0cmltOiB0cnVlLFxuICAgICAgbWF4bGVuZ3RoOiA1MCxcbiAgICB9LFxuICAgIGJpcnRoTW9udGg6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIG1pbjogMSxcbiAgICAgIG1heDogMTIsXG4gICAgfSxcbiAgICBiaXJ0aERheToge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgbWluOiAxLFxuICAgICAgbWF4OiAzMSxcbiAgICB9LFxuICAgIGJpbzoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgbWF4bGVuZ3RoOiAyNTAsXG4gICAgICBkZWZhdWx0OiBcIlwiLFxuICAgIH0sXG4gICAgYWZmaWxpYXRpb246IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIG1heGxlbmd0aDogMTAwLFxuICAgICAgZGVmYXVsdDogXCJPdGhlclwiLFxuICAgIH0sXG4gICAgdGVjaENhcmVlclBhdGg6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGVudW06IFtcIkZyb250ZW5kIERldmVsb3BlclwiLCBcIkJhY2tlbmQgRGV2ZWxvcGVyXCIsIFwiRnVsbCBTdGFjayBEZXZlbG9wZXJcIiwgXCJNb2JpbGUgRGV2ZWxvcGVyXCIsIFwiRGV2T3BzIEVuZ2luZWVyXCIsIFwiRGF0YSBTY2llbnRpc3RcIiwgXCJNTCBFbmdpbmVlclwiLCBcIkNsb3VkIEFyY2hpdGVjdFwiLCBcIlNlY3VyaXR5IEVuZ2luZWVyXCIsIFwiVUkvVVggRGVzaWduZXJcIiwgXCJPdGhlclwiXSxcbiAgICB9LFxuICAgIHRlY2hTdGFjazogW3tcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHRyaW06IHRydWUsXG4gICAgfV0sXG4gICAgZXhwZXJpZW5jZUxldmVsOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBlbnVtOiBbXCJiZWdpbm5lclwiLCBcImludGVybWVkaWF0ZVwiLCBcImFkdmFuY2VkXCIsIFwiZXhwZXJ0XCJdLFxuICAgICAgZGVmYXVsdDogXCJiZWdpbm5lclwiLFxuICAgIH0sXG4gICAgZ2l0aHViVXNlcm5hbWU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIHRyaW06IHRydWUsXG4gICAgfSxcbiAgICBsaW5rZWRpblVybDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICB9LFxuICAgIHBvcnRmb2xpb1VybDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICB9LFxuICAgIGF2YXRhcjoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZGVmYXVsdDogXCJcIiwgLy8gV2Ugc2V0IGRlZmF1bHQgdG8gZW1wdHkgc3RyaW5nIHNvIHRoZSBwcmUtc2F2ZSBob29rIGNhbiBjYXRjaCBpdFxuICAgIH0sXG4gICAgZ2VuZGVyOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBlbnVtOiBbXCJtYWxlXCIsIFwiZmVtYWxlXCIsIFwib3RoZXJcIl0sXG4gICAgfSxcbiAgICB1c2VyVHlwZToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgZW51bTogW1wic3R1ZGVudFwiLCBcImRldmVsb3BlclwiLCBcImRlc2lnbmVyXCIsIFwiZW50cmVwcmVuZXVyXCIsIFwib3RoZXJcIl0sXG4gICAgfSxcbiAgICBiYW5uZXJVcmw6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGRlZmF1bHQ6IFwiXCIsIC8vIE5ldyBmaWVsZCBmb3IgdXNlciBiYW5uZXJcbiAgICB9LFxuICAgIHJvbGU6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGVudW06IFtcInVzZXJcIiwgXCJtb2RlcmF0b3JcIiwgXCJhZG1pblwiLCBcImFuYWx5dGljc1wiXSxcbiAgICAgIGRlZmF1bHQ6IFwidXNlclwiLFxuICAgIH0sXG4gICAgcG9pbnRzOiB7XG4gICAgICB0eXBlOiBOdW1iZXIsXG4gICAgICBkZWZhdWx0OiAxMCwgLy8gWW91ciBkZWZhdWx0IGlzIDEwLCB3aGljaCBpcyBncmVhdCFcbiAgICAgIGluZGV4OiB0cnVlLFxuICAgIH0sXG4gICAgYmFkZ2VzOiBbeyB0eXBlOiBTdHJpbmcgfV0sXG4gICAgbGV2ZWw6IHsgdHlwZTogTnVtYmVyLCBkZWZhdWx0OiAxIH0sXG4gICAgZGlzcGxheU5hbWU6IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgbG9jYXRpb246IHsgdHlwZTogU3RyaW5nLCB0cmltOiB0cnVlIH0sXG4gICAgd2Vic2l0ZTogeyB0eXBlOiBTdHJpbmcsIHRyaW06IHRydWUgfSxcbiAgICBpc1ZlcmlmaWVkOiB7IHR5cGU6IEJvb2xlYW4sIGRlZmF1bHQ6IGZhbHNlIH0sXG4gICAgdmVyaWZpY2F0aW9uVG9rZW46IHsgdHlwZTogU3RyaW5nLCBkZWZhdWx0OiBudWxsIH0sXG4gICAgdmVyaWZpY2F0aW9uVG9rZW5FeHBpcmVzOiB7IHR5cGU6IERhdGUsIGRlZmF1bHQ6IG51bGwgfSxcbiAgICByZXNldFBhc3N3b3JkVG9rZW46IHsgdHlwZTogU3RyaW5nLCBkZWZhdWx0OiBudWxsIH0sXG4gICAgcmVzZXRQYXNzd29yZEV4cGlyZXM6IHsgdHlwZTogRGF0ZSwgZGVmYXVsdDogbnVsbCB9LFxuICAgIHJlZnJlc2hUb2tlbnM6IFt7IHR5cGU6IFN0cmluZyB9XSxcbiAgICBsYXN0TG9naW46IHsgdHlwZTogRGF0ZSB9LFxuICAgIGxvZ2luU3RyZWFrOiB7IHR5cGU6IE51bWJlciwgZGVmYXVsdDogMCB9LFxuICAgIGxhc3RTdHJlYWtEYXRlOiB7IHR5cGU6IERhdGUgfSxcbiAgICByZWZlcnJhbENvZGU6IHsgXG4gICAgICB0eXBlOiBTdHJpbmcsIFxuICAgICAgdW5pcXVlOiB0cnVlLCBcbiAgICAgIHNwYXJzZTogdHJ1ZSxcbiAgICAgIGluZGV4OiB0cnVlLFxuICAgIH0sXG4gICAgb25ib2FyZGluZ0NvbXBsZXRlZDoge1xuICAgICAgdHlwZTogQm9vbGVhbixcbiAgICAgIGRlZmF1bHQ6IGZhbHNlLFxuICAgICAgaW5kZXg6IHRydWUsXG4gICAgfSxcbiAgICBmb2xsb3dlcnNDb3VudDoge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogMCxcbiAgICAgIGluZGV4OiB0cnVlLFxuICAgIH0sXG4gICAgZm9sbG93aW5nQ291bnQ6IHtcbiAgICAgIHR5cGU6IE51bWJlcixcbiAgICAgIGRlZmF1bHQ6IDAsXG4gICAgICBpbmRleDogdHJ1ZSxcbiAgICB9LFxuICAgIGxhc3RBY3RpdmU6IHtcbiAgICAgIHR5cGU6IERhdGUsXG4gICAgICBkZWZhdWx0OiBEYXRlLm5vdyxcbiAgICAgIGluZGV4OiB0cnVlLFxuICAgIH0sXG4gICAgc2Vzc2lvblN0YXJ0OiB7XG4gICAgICB0eXBlOiBEYXRlLFxuICAgICAgZGVmYXVsdDogRGF0ZS5ub3csXG4gICAgfSxcbiAgICByZWdpc3RyYXRpb25Tb3VyY2U6IHtcbiAgICAgIHR5cGU6IFN0cmluZyxcbiAgICAgIGVudW06IFsnb3JnYW5pYycsICdyZWZlcnJhbCcsICdzb2NpYWwnLCAnZGlyZWN0JywgJ2VtYWlsJywgJ3NlYXJjaCddLFxuICAgICAgZGVmYXVsdDogJ2RpcmVjdCdcbiAgICB9LFxuICAgIHJlZmVycmVyOiB7XG4gICAgICB0eXBlOiBTdHJpbmcsXG4gICAgICBkZWZhdWx0OiAnJ1xuICAgIH0sXG4gICAgY291bnRyeToge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICB9LFxuICAgIGlzR2VuZXJhdGVkOiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgICBpbmRleDogdHJ1ZSxcbiAgICB9LFxuICAgIGhlZGVyYUFjY291bnRJZDoge1xuICAgICAgdHlwZTogU3RyaW5nLFxuICAgICAgdHJpbTogdHJ1ZSxcbiAgICAgIHNwYXJzZTogdHJ1ZSxcbiAgICAgIGluZGV4OiB0cnVlLFxuICAgIH0sXG4gICAgd2FsbGV0Q29ubmVjdGVkOiB7XG4gICAgICB0eXBlOiBCb29sZWFuLFxuICAgICAgZGVmYXVsdDogZmFsc2UsXG4gICAgfSxcbiAgICBkZW1vV2FsbGV0QmFsYW5jZToge1xuICAgICAgdHlwZTogTnVtYmVyLFxuICAgICAgZGVmYXVsdDogMTAwLCAvLyBFYWNoIHVzZXIgc3RhcnRzIHdpdGggMTAwIGRlbW8gSEJBUlxuICAgICAgbWluOiAwLFxuICAgICAgaW5kZXg6IHRydWUsXG4gICAgfSxcbiAgfSxcbiAgeyB0aW1lc3RhbXBzOiB0cnVlIH1cbik7XG5cbi8vIC0tLSBTVEFSVDogQ09NQklORUQgTUlERExFV0FSRSAtLS1cblxuVXNlclNjaGVtYS5wcmUoXCJzYXZlXCIsIGZ1bmN0aW9uIChuZXh0KSB7XG4gIC8vIDEuIExldmVsIGNhbGN1bGF0aW9uIGxvZ2ljXG4gIGlmICh0aGlzLmlzTW9kaWZpZWQoXCJwb2ludHNcIikpIHtcbiAgICB0aGlzLmxldmVsID0gTWF0aC5mbG9vcih0aGlzLnBvaW50cyAvIDEwMDApICsgMTtcbiAgfVxuXG4gIC8vIDIuIEdlbmVyYXRlIGF2YXRhciBmb3IgbmV3IHVzZXJzICh3aWxsIGJlIG92ZXJyaWRkZW4gZHVyaW5nIG9uYm9hcmRpbmcpXG4gIGlmICh0aGlzLmlzTmV3ICYmICF0aGlzLmF2YXRhcikge1xuICAgIGNvbnN0IHNlZWQgPSB0aGlzLnVzZXJuYW1lO1xuICAgIGlmICh0aGlzLmdlbmRlciA9PT0gXCJtYWxlXCIpIHtcbiAgICAgIHRoaXMuYXZhdGFyID0gYGh0dHBzOi8vbW9kZWxzLnJlYWR5cGxheWVyLm1lLzY0YmZhNzVmMGU3MmM2M2Q3YzM5MzRhNi5nbGI/bW9ycGhUYXJnZXRzPUFSS2l0JnRleHR1cmVBdGxhcz0xMDI0JmxvZD0xJmdlbmRlcj1tYWxlJnNlZWQ9JHtzZWVkfWA7XG4gICAgfSBlbHNlIGlmICh0aGlzLmdlbmRlciA9PT0gXCJmZW1hbGVcIikge1xuICAgICAgdGhpcy5hdmF0YXIgPSBgaHR0cHM6Ly9tb2RlbHMucmVhZHlwbGF5ZXIubWUvNjRiZmE3NWYwZTcyYzYzZDdjMzkzNGE2LmdsYj9tb3JwaFRhcmdldHM9QVJLaXQmdGV4dHVyZUF0bGFzPTEwMjQmbG9kPTEmZ2VuZGVyPWZlbWFsZSZzZWVkPSR7c2VlZH1gO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmF2YXRhciA9IGBodHRwczovL21vZGVscy5yZWFkeXBsYXllci5tZS82NGJmYTc1ZjBlNzJjNjNkN2MzOTM0YTYuZ2xiP21vcnBoVGFyZ2V0cz1BUktpdCZ0ZXh0dXJlQXRsYXM9MTAyNCZsb2Q9MSZzZWVkPSR7c2VlZH1gO1xuICAgIH1cbiAgfVxuXG4gIC8vIDMuIEdlbmVyYXRlIHJlZmVycmFsIGNvZGUgZm9yIG5ldyB1c2Vyc1xuICBpZiAodGhpcy5pc05ldyAmJiAhdGhpcy5yZWZlcnJhbENvZGUpIHtcbiAgICBjb25zdCB0aW1lc3RhbXAgPSBEYXRlLm5vdygpLnRvU3RyaW5nKDM2KTtcbiAgICBjb25zdCB1c2VybmFtZSA9IHRoaXMudXNlcm5hbWUuc3Vic3RyaW5nKDAsIDQpLnRvVXBwZXJDYXNlKCk7XG4gICAgY29uc3QgcmFuZG9tID0gTWF0aC5yYW5kb20oKS50b1N0cmluZygzNikuc3Vic3RyaW5nKDIsIDYpLnRvVXBwZXJDYXNlKCk7XG4gICAgdGhpcy5yZWZlcnJhbENvZGUgPSBgJHt1c2VybmFtZX0ke3RpbWVzdGFtcH0ke3JhbmRvbX1gO1xuICB9XG5cbiAgbmV4dCgpO1xufSk7XG5cbi8vIC0tLSBFTkQ6IENPTUJJTkVEIE1JRERMRVdBUkUgLS0tXG5cblxuLy8gWW91ciBleGlzdGluZyBtZXRob2RzXG5Vc2VyU2NoZW1hLm1ldGhvZHMuY2FsY3VsYXRlTGV2ZWwgPSBmdW5jdGlvbiAoKSB7XG4gIHJldHVybiBNYXRoLmZsb29yKHRoaXMucG9pbnRzIC8gMTAwMCkgKyAxO1xufTtcblxuVXNlclNjaGVtYS5tZXRob2RzLmNsZWFuRXhwaXJlZFRva2VucyA9IGZ1bmN0aW9uICgpIHtcbiAgLy8gLi4uICh5b3VyIGV4aXN0aW5nIGxvZ2ljIGlzIHBlcmZlY3QpXG59O1xuXG5leHBvcnQgZGVmYXVsdCBtb2RlbHMuVXNlciB8fCBtb2RlbDxJVXNlcj4oXCJVc2VyXCIsIFVzZXJTY2hlbWEpOyJdLCJ2ZXJzaW9uIjozfQ==