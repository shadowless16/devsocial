{"file":"C:\\Users\\akdav\\Downloads\\devsocial\\app\\api\\referrals\\create\\route.ts","mappings":"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","names":[],"sources":["C:\\Users\\akdav\\Downloads\\devsocial\\app\\api\\referrals\\create\\route.ts"],"sourcesContent":["import { type NextRequest, NextResponse } from \"next/server\"\nimport { authMiddleware } from \"@/middleware/auth\"\nimport { ReferralSystemFixed } from \"@/utils/referral-system-fixed\"\n\n\n\nexport const dynamic = 'force-dynamic'\n\nexport async function POST(request: NextRequest) {\n  try {\n    const authResult = await authMiddleware(request)\n    if (!authResult.success) {\n      return NextResponse.json({ success: false, message: authResult.error || 'Authentication failed' }, { status: 401 })\n    }\n\n    const userId = authResult.user!.id\n    const { referredUserId } = await request.json()\n\n    if (!referredUserId) {\n      return NextResponse.json({ success: false, message: \"Referred user ID is required\" }, { status: 400 })\n    }\n\n    if (userId === referredUserId) {\n      return NextResponse.json({ success: false, message: \"Cannot refer yourself\" }, { status: 400 })\n    }\n\n    const referral = await ReferralSystemFixed.createReferral(userId, referredUserId)\n\n    return NextResponse.json({ success: true, data: { referral } }, { status: 201 })\n  } catch (error: any) {\n    console.error(\"Error creating referral:\", error)\n    return NextResponse.json({ success: false, message: error.message || \"Failed to create referral\" }, { status: 500 })\n  }\n}\n\nexport async function GET(request: NextRequest) {\n  try {\n    const authResult = await authMiddleware(request)\n    if (!authResult.success) {\n      return NextResponse.json({ success: false, message: authResult.error || 'Authentication failed' }, { status: 401 })\n    }\n\n    const userId = authResult.user!.id\n    const referralCode = await ReferralSystemFixed.getReferralCode(userId)\n\n    return NextResponse.json({ success: true, data: { referralCode } })\n  } catch (error) {\n    console.error(\"Error generating referral code:\", error)\n    return NextResponse.json({ success: false, message: \"Failed to generate referral code\" }, { status: 500 })\n  }\n}\n"],"version":3}